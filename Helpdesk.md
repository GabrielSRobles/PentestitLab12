# Helpdesk

Among the domain names found with the DNS challenge zone transfer, is one that sounds useful for this challenge.

```
helpdesk.test.lab.	21600	IN	A	172.16.0.10
```

So, lets add this to our /etc/hosts file and see what is on this page.

## Info gathering

Right away we find that this domain name gives us access to a new web page. The first thing we see is a login.

Try using the known credentials and we get login access.

The next page seems to display "tickets" created by the user and their status. 

We find a **new request** input. After trying to break it for a while, to no avail, we go on.

There is an usually critical functionality, a password change. We try changing our password, resulting in a request with an interesting body. For starters, there is no **current password** field. For other, that **id** field seems suspicious.

password=test&confpassword=test&id=MTQ1Cg%3D%3D&submit=Change

Lets try decoding this parameter:

* The %3D look like a url encoding. Decoding gives us MTQ1Cg==.
* The double "=" seems like a base64. Decode and we get **145\n**

The form is quite badly done, and allows the user to tamper with the id of the user that it affects. The break line is annoying, but no defense at all.

What happens if we try this with other payloads? For example, the following strings, encoded:

* **145\n** (the original payload) => We get a 302. We will use this to determine success and failure.
* **145** (without the line break) => We get a 200. Failure, we need that line break
* **1\n** (a random id) => We get a 200. Failure, so a random id in valid format does not work either.

This is good, as we can change any user and be aware of success or failure.

## Getting the token

I will be using Burp Intruder to make to automate the requests, but will create the payload list with a simple python scrypt.

```python
import base64
import urllib

for x in range(999):
    print urllib.quote(base64.encodestring('%i\n' % x).replace('\n',''))
```
isanother success with the same payload, at request 146. And then, success, we get value NDQwCg%3D%3D at request number 441. We have successfully changed the password of the user with ID 440.

But, we do not have the user name. Or do we? Our current credentials have been everywhere, and **info** shows among the domain names. Maybe the user we modified is also a domain user?

We try with the names we had and finally find the right one. Just, remember that we are using emails, not simply the domain user name. I recommend saving the password for later, in case the vpn resets.

The password we got is the token for this challenge.