# VPN

Last time we did an scan on the network, we found nothing that would strike our fancy regarding VPNs. But now we have a new user, which means new permissions. Could be less, lets hope it is more. 

## Info gathering

Lets look at the info we have regarding the VPNs.
We can start by reading the pentestit initial vpn config. There we can find to what server/port we are connecting.   

```
remote vpn.pentestit.ru 443
```

This is a public server and not that interesting. What about our second vpn config?

```
remote 192.168.101.13 1194
```

This is inside our VPN, and that is great. We can see that the vpn service is running on port 1194. What if we searched all services running on that port?

* sudo nmap -Pn -n -sU -p 1194 192.168.101.0/24 --open

```
192.168.101.12
PORT     STATE SERVICE
1194/udp open  openvpn

192.168.101.13
PORT     STATE SERVICE
1194/udp open  openvpn
```

We already knew about 192.168.101.13, since we are already connected to this. But there is another VPN on 192.168.101.12.

We can make another config, copying the **vpn.conf** and changing the IP. Using our new credentials, we manage to login properly.

* ip ro show dev tun1

```
10.12.0.1 via 10.12.0.13 
10.12.0.13 proto kernel scope link src 10.12.0.14 
172.16.0.0/16 via 10.12.0.13 
192.168.0.0/24 via 10.12.0.13 
```

This is different that what we had before. 

Lets review the 192.168.0.0/24 range. 

When we try to do a ping scan, nothing shows up, so we go add the -Pn flag. This lets us see some more info.

In this segment we find a bunch of ssh ports 22 open in a few servers.

* 192.168.0.10
* 192.168.0.15
* 192.168.0.30
* 192.168.0.100

The other segment is bigger and more interesting for this challenge.
We run a simple ping scan and find the following hosts

* 172.16.0.10
```
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.16.0
```
* 172.16.0.14
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u4 (protocol 2.0)
80/tcp open  http    nginx 1.14.2
```
* 172.16.0.17
```
PORT     STATE SERVICE      VERSION
22/tcp   open  ssh          OpenSSH 7.4p1 Debian 10+deb9u4 (protocol 2.0)
25/tcp   open  smtp         Postfix smtpd
53/tcp   open  domain       ISC BIND 9.10.3-P4-Debian
80/tcp   open  http         nginx 1.16.0
88/tcp   open  kerberos-sec Heimdal Kerberos (server time: 2019-05-28 18:19:26Z)
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: TEST)
143/tcp  open  imap         Dovecot imapd
445/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: TEST)
464/tcp  open  kpasswd5?
636/tcp  open  ssl/ldap     (Anonymous bind OK)
1024/tcp open  msrpc        Microsoft Windows RPC
3268/tcp open  ldap         (Anonymous bind OK)
3269/tcp open  ssl/ldap     (Anonymous bind OK)
8080/tcp open  http         nginx
```
* 172.16.1.10
```
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.10.3
```
* 172.16.1.12
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u4 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.25
```
* 172.16.1.15
```
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.14.2
```

## Getting the token

There are some IPs we had already seen, but several of them are new. A few `curl -v` commands to see what is in the http servers (Please no more of the same blog) and we get the token from one of these pages.