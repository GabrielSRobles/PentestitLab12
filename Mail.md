# Mail

So, the token should be somewhere somehow related to an email.

We have to IPs to get start lets run some commands to get more information about them.

## Info gathering

Lets check out their ports:

---

* 192.168.101.12

`nmap -sV 192.168.101.12`

```
PORT     STATE SERVICE VERSION
25/tcp   open  smtp    Postfix smtpd
80/tcp   open  http    nginx 1.16.0
143/tcp  open  imap    Dovecot imapd
8080/tcp open  http    nginx
Service Info: Host: -mail.test.lab
```

This looks promising, the Host name helps too.
* 25    (default) we have a smtp service.
* 80    (default) a http service 
* 143   (default) a IMAP service
* 8080  another http service

Both 25 and 143 ports are being used for mailing related activities, receiving and distributing emails to the users.

Lets look at the two http services.

### Port 80
Here we find we are being redirected to **site.test.lab** but we can't resolve this URL, so we get an error. Lets set our host file so that the **site.test.lab** is resolved to this server. We add this line to the file:

`192.168.101.12 site.test.lab`

Now we can navigate to the site and see a little blog. We read the content of the maing page and (since we are working with email) write down the single mail we found:

* info@test.lab

We take a look at the rest of the posts (searching for empty) and see a link to a dashboard. This also redirects us to site.test.lab and we lose the endpoint, lets try:

* http://site.test.lab/wp-admin/

Now we have access to a word press dashboard login. But lets just keep this in mind for now. Might be useful for another challenge?

### Port 8080

We find a **Roundcube Webmail** login. We can guess that the email we got is a valid user, but we do not have the password. Lets try to crack this with some password lists.

## List attack on the login

### Tools:
* Hydra, for forcing the login
* rockyou.txt, password list

The IMAP service provides login functionality, so we will try to get access through it.
Lets try to login manually, to know what the tool we will use does.

We can connect using both, getting similar results.:

* nc 192.168.101.12 143
* telnet 192.168.101.12 143

Afterwards we get connection to the service and can try to login:

`a login info@test.lab test`

This works properly, giving us an error message:

`a NO [AUTHENTICATIONFAILED] Authentication failed.`

Now, lets try using **hydra** to get in.
First we check what is the syntax:

```
hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] [-e nsr] [-o FILE] [-t TASKS] [-M FILE [-T TASKS]] [-w TIME] [-W TIME] [-f] [-s PORT] [-x MIN:MAX:CHARSET] [-c TIME] [-ISOuvVd46] [service://server[:PORT][/OPT]]
```

The important parameters for are:
* -l to specify login, which we have
* -P to specify a password list, rockyou.txt in our case
* [service://server] to specify the service.

In our case service is **imap** and the server is 192.168.12.143. We don't need to specify the port because it is the default one for the service.

We run `hydra -l info@test.lab -P rockyou.txt imap://192.168.101.12` and after a moment we have a succesful login:

```
[143][imap] host: 192.168.101.12   login: info@test.lab   password: 123456789
```

We can now use this for login to the webmail server (or do it through the imap, but that is more work than needs be).

Inside the **inbox** we see an interesting **OVPN** email, with another OpenVPN config file. Insite the **sent** folder we can see the token we were searching for. We turn it in and we are 6% done with the challenge!.

## Next step

Now, with our new VPN file we head to the **DNS** challenge